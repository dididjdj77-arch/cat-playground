

## 결정 (추가)

### 결정: Observation 저장은 H3 하이브리드 원칙
**무엇**: Observation 저장은 H3 하이브리드 원칙을 따른다. 자주 조회/필터/통계에 쓰이는 핵심 필드는 정규 컬럼(+인덱스)으로 승격하고, 롱테일/가변 정보만 JSONB로 유지한다.

**의미**: 검색 성능과 통계 정확도를 확보하면서도 스키마 경직성을 최소화한다. JSONB 단일 의존의 한계를 해소한다.

**영향**:
- **UX**: 빠른 필터/집계 응답으로 목록·대시보드 체감 성능 개선
- **데이터**: 인덱스 기반 질의 가능, 검증 가능한 타입/제약 적용
- **권한**: 컬럼 단위 접근/마스킹 정책 적용 용이

**변경 시 조건**: 원칙 변경 또는 승격 기준의 변경은 ADR이 필요하다.

---

### 결정: 멀티캣 관찰 저장의 원자성
**무엇**: UI 1카드 = DB N레코드 구조의 멀티캣 관찰 저장은 Supabase RPC(또는 동등한 서버 트랜잭션)로 그룹 생성 + N레코드를 한 트랜잭션으로 처리한다. 실패 시 전체 롤백한다.

**의미**: 부분 성공으로 인한 데이터 찢김을 방지한다.

**영향**:
- **UX**: 저장 실패 시 일관된 실패/재시도 경험
- **데이터**: 참조 무결성 보장, 고아 레코드 방지
- **운영**: 재처리/복구 단순화

**변경 시 조건**: 트랜잭션 경계 또는 저장 모델 변경은 ADR이 필요하다.
