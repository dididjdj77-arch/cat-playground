# DECISIONS — 확정(LOCK) 원장

규칙: LOCK만 기록. 변경 시 ADR 필요 여부를 함께 적는다.


## D-027. SSOT 문서 자동 PR 규칙
SSOT 문서 변경은 D-### 결정 키를 기준으로 수행한다(헤딩 전체 텍스트 일치에 의존하지 않는다).
동일 요청을 여러 번 실행해도 동일 PR을 반환해야 한다(멱등성).
GitHub Contents API는 대상 브랜치의 최신 sha 기준으로 처리한다.
sha mismatch(409) 발생 시 최신 sha 재조회 후 1회 재시도한다.

## D-001 앱 IA(하단 탭) + 소셜 세그먼트
- 무엇: 하단 탭 4개(하우스/다이어리/소셜/설정). 소셜 세그먼트 2개(냥스타그램, 채널). (추후) 알림, 내 활동.
- 의미: 도메인(기록 vs 공개)을 구조적으로 분리.
- 영향: 라우팅/권한/캐시 구조 전반.
- 변경: ADR 필요.

## D-002 공개/비공개 혼란 방지: 표면 분리
- 무엇:
  - 다이어리 탭 = 내 것(관찰 + 내 냥스타그램), log_date 기준 그룹
  - 소셜/웹 = 공개 + 발행된 것만 탐색/상호작용
- 의미: “이게 공개냐?” 혼란을 설계로 제거.
- 영향: 노출 정책이 앱/웹/서버 공통 규칙.
- 변경: ADR 필요(노출 사고 리스크).

## D-003 다이어리 탭 UX(인라인 2패널 + B1)
- 무엇:
  - 상단 인라인 작성 패널 2개(관찰/내 냥스타), 기본 접힘, 저장 시 자동 접힘
  - 하단 날짜 헤더 그룹 리스트(B1), log_date 기준
  - 과거 날짜 작성 시 과거 섹션으로(최신 취급 금지)
  - 달력은 다이어리 탭 안에서만(한 페이지), 점프용
- 의미: 라이트 입력 + 회고 정합성.
- 영향: 리스트 페이징/가상화 필요.
- 변경: ADR 권장.

## D-004 드래프트 정책(로컬-only)
- 무엇: 드래프트는 로컬 저장만. 서버 반영은 저장 버튼 시점.
- 의미: 서버 복잡도↓, 입력 손실↓.
- 영향: 멀티디바이스 동기화는 v2 선택.
- 변경: ADR 권장.

## D-005 관찰(다묘) 핵심: C2/D2/E2 + 표현/저장 분리
- 무엇:
  - 일괄작성(멀티 체크) + 개별작성(싱글) 모두 지원
  - 공통 입력 + 고양이별 override 옵션
  - UI는 날짜당 1카드처럼, 저장은 고양이별 N 레코드
  - 제외는 삭제가 아니라 excluded 상태(숨김 + 복구)
- 의미: 다묘 UX/정합성의 핵심.
- 영향: 원자적 저장/재시도/동시성 제어 필수.
- 변경: ADR 필요.

## D-006 하우스(집) 탭 방향
- 무엇: 고양이 카드 + 추가, 냥벤토리 현황/수정(변경은 가끔).
- 의미: 하우스(상태) vs 다이어리(빈번 입력) 분리.
- 영향: 인벤토리 정규화(AC-3)와 연결.
- 변경: ADR 권장.

## D-007 내 냥스타그램 상태 모델(V2 + N1)
- 무엇:
  - log_date 선택(기본 오늘)
  - visibility(private/public)
  - published_at(null/ts)
  - 노출: public AND published_at not null AND not hidden
  - 발행/발행취소: published_at set/unset
- 의미: 공개 의도와 발행 의도를 분리해 안전한 공개 UX.
- 영향: 인덱스/쿼리 기준이 2축(log_date/published_at).
- 변경: ADR 필요.

## D-008 냥스타그램 v1 상호작용
- 무엇: 좋아요 + 댓글 CRUD(수정 포함).
- 의미: 커뮤니티 최소 완결.
- 영향: 운영 장치(신고/차단/레이트리밋) 필수 결합.
- 변경: ADR 권장.

## D-009 댓글 수정 정책(현업 표준형)
- 무엇: 시간 제한 없음 + “수정됨” 표시 + 내부 감사로그(이전 본문 1개 보관). 사용자에게 이력 UI는 제공하지 않음.
- 의미: UX 단순 + 분쟁 대응 최소 기반.
- 영향: comment_revisions 등 감사로그 필요.
- 변경: ADR 권장.

## D-010 log_date 방어(미래 금지)
- 무엇: log_date는 오늘 이하만 허용. 극단 과거 허용.
- 의미: 정렬/통계/회고의 일관성.
- 영향: “미래 계획”은 schedule_date 같은 별도 도메인으로 분리해야 함.
- 변경: ADR 필요.

## D-011 SSOT 운영 방식
- 무엇: DECISIONS/OPEN/TODO/ADR를 SSOT로 운영. 매 회차 종료 시 LOCK/OPEN/TODO 변경을 3줄로 확인.
- 의미: 누락을 구조적으로 방지.
- 영향: 구현은 TODO 티켓 단위로만 진행.
- 변경: ADR 불필요(프로세스).

## D-012 AC-3 정규화(자동완성/추천/제안큐/승인 UI)
- 무엇:
  - 자동완성 목록 → 없으면 자유입력 허용(막지 않음)
  - 자유입력 시: 기존 항목 매핑 추천 OR 신규 등록 요청(pending)
  - 관리자 UI: pending 승인/거절, 별칭 등록, 병합(최소)
  - 데이터: catalog_items / catalog_aliases / catalog_suggestions + raw_text 보존
- 의미: 입력 마찰 없이 데이터 자산화.
- 영향: 운영 UI/정책/권한 필요.
- 변경: ADR 필요.

## D-013 채널 v1 범위(Blind 벤치마킹, 익명성 제외)
- 무엇: 글/답글(1-depth)/좋아요/검색 + 인기/최신/팔로잉 + 토픽 팔로우.
- 의미: 커뮤니티 축적/탐색 엔진을 v1부터 확보.
- 영향: 검색/집계/운영 장치 필수.
- 변경: ADR 필요.

## D-014 운영 최소장치 v1
- 무엇: 액션별 레이트리밋 + 신고 + 차단(상호 비노출) + 조건부 자동숨김 + 감사로그.
- 의미: 공개+SEO 환경에서 생존 조건.
- 영향: 정책 레이어/관리 도구 필요.
- 변경: ADR 권장.

## D-015 웹(SEO) 원칙
- 무엇:
  - 웹 목적=SEO 유입
  - SSR/ISR 전제
  - index: 토픽 랜딩/스레드 상세/공개 글 상세
  - noindex: 내부 검색 결과
- 의미: 유입 엔진을 기술/정책으로 고정.
- 영향: 품질 게이트/캐시 재검증 필요.
- 변경: ADR 필요.

## D-016 토픽 전부 공개(SEO 대상)
- 무엇: 채널 토픽은 전부 공개 읽기 가능(웹 색인 대상).
- 의미: 성장 극대화.
- 영향: 운영/부하 리스크 ↑ (D-014/015 필수).
- 변경: ADR 필요.

## D-017 닉네임 중심 탐색 UX(액션 메뉴)
- 무엇: 닉네임 탭 시 즉시 이동이 아니라 메뉴(고양이정보/하우스보기/냥스타그램). 작성글/활동은 추후 확장.
- 의미: Blind류 UX 유지 + 오동작/이탈 감소.
- 영향: 권한/차단/공개 설정에 따른 메뉴 노출 제어 필요.
- 변경: ADR 권장.

## D-018 인벤토리 공개/비공개는 사용자 설정(기본값 비공개 권장)
- 무엇: 인벤토리 공개 여부는 사용자 설정. 공개 시 v1은 요약 노출 우선.
- 의미: 탐색/프라이버시 균형.
- 영향: AUTHZ/프로필 설계에 반영.
- 변경: ADR 권장.

## D-019 차단(Block): 상호 비노출 + 상호작용 불가
- 무엇: A가 B를 차단하면 서로 콘텐츠/프로필 비노출, 상호작용 불가.
- 의미: 분쟁/괴롭힘 리스크 최소화.
- 영향: 모든 조회/검색/프로필 공통 필터.
- 변경: ADR 권장.

## D-020 공개글 프로필 노출 분리: hide_from_profile
- 무엇: 공개+발행 글이라도 프로필 목록에서는 숨길 수 있음(피드/링크는 공개 유지). 문구로 명확화.
- 의미: “공개”와 “프로필 진열” 니즈 분리.
- 영향: 상태 조합 증가 → UX 명확화 필수.
- 변경: ADR 권장.

## D-021 내부 검색 결과 noindex
- 무엇: 검색 결과 페이지는 noindex.
- 의미: 얇은 페이지/중복 색인 방지.
- 영향: SEO 품질 유지.
- 변경: ADR 권장.

## D-022 관찰 저장 가드레일(심화)
- 무엇: Upsert(전체)/Patch(부분) 분리 + 트랜잭션 + idempotency + version 충돌(409).
- 의미: 재시도/동시편집/부분편집에서 데이터 찢김 방지.
- 영향: group.version / expected_version 필요.
- 변경: ADR 필요.

## D-023 채널 기술 가드레일(심화)
- 무엇: 피드 3종 쿼리/캐시 분리, cursor pagination, FTS 인덱스, likes unique + 카운트 보정 잡.
- 의미: v1에서 성능/정합성/운영 리스크 최소화.
- 영향: 집계/보정 작업 설계 필요.
- 변경: ADR 권장.

## D-024 자동숨김 가드레일(심화)
- 무엇: 신고 임계치 조건 충족 시 hidden_at만 설정(삭제 금지). 정책은 설정값화. 감사로그 필수.
- 의미: 신고 악용/운영 사고 방지.
- 영향: 수치(임계치/신뢰조건)는 OPEN.
- 변경: ADR 권장.

## D-025 SEO 가드레일(심화)
- 무엇: SSR/ISR + index 범위 제한 + 품질 게이트(스팸/hidden 제외) + 이벤트 기반 재검증 트리거.
- 의미: SEO를 “기술+운영”으로 보장.
- 영향: hidden/deleted의 404/410 전략은 OPEN.
- 변경: ADR 권장.

## D-026 공개 부하/스크래핑 대응 여지
- 무엇: 공개 페이지는 CDN/ISR 캐시 가능 형태로 설계. 공개 API/인증 API 분리. 필요 시 WAF/봇 룰 확장 여지.
- 의미: 성장 엔진 부하를 인프라로 흡수.
- 영향: 배포/캐시 정책 문서 필요.
- 변경: ADR 권장.

## 해소된 충돌(근거)
- 채널 v1 범위: “답글/좋아요/검색까지 포함” 사용자 확정 발언으로 D-013 고정.
- 닉네임 이동 UX: “바로 페이지 이동 아님, 메뉴로” 사용자 확정 발언으로 D-017 고정.
